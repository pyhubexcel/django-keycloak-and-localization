{% extends 'base.html' %}
{% load i18n %}

{% block content %}

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-success alert-dismissible fade show mt-4" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="{% trans "Close" %}">
                <span aria-hidden="true">&times;</span>
                <span class="sr-only">{% trans "Close" %}</span>
            </button>
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<div class="container">
    <!-- Language Switcher -->
    <div class="dropdown mb-4">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {% trans "Language" %}
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            {% get_current_language as LANGUAGE_CODE %}
            {% get_available_languages as LANGUAGES %}
            {% for language in LANGUAGES %}
                {% if language.code != LANGUAGE_CODE %}
                    <a class="dropdown-item" href="{% url 'set_language' %}?next={{ request.path }}&language={{ language.code }}">{{ language.name }}</a>
                {% else %}
                    <span class="dropdown-item active">{{ language.name }}</span>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <div class="col-md-6 offset-md-3">
        {% if request.user.is_authenticated %}
            <h1 class="text-muted text-center mt-3 mb-3">{% trans "User Information" %}</h1>
            <ul class="list-group">
                <li class="list-group-item"><b>{% trans "Name:" %}</b> {{ user_info.name }}</li>
                <li class="list-group-item"><b>{% trans "Username:" %}</b> {{ user_info.preferred_username }}</li>
                <li class="list-group-item"><b>{% trans "Email:" %}</b> {{ user_info.email }}</li>
            </ul>
        {% else %}
            <h1 class="text-muted text-center mt-5 mb-5">{% trans "Welcome to User Authentication App" %}</h1>
            <h2 class="text-muted text-center mt-5">{% trans "Login to see user information" %}</h2>
        {% endif %}
    </div>
</div>

{% comment %} <script>
    document.addEventListener("DOMContentLoaded", function() {
        var redirectUrl;
        {% if request.user.is_authenticated %}
            redirectUrl = "/api/v1/authenticated";
        {% else %}
            redirectUrl = "/api/v1/unauthenticated";
        {% endif %}
        history.replaceState(null, null, redirectUrl);
    });
</script> {% endcomment %}

{% endblock content %}